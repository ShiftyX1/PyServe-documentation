---
sidebar_position: 5
---

# Vibe-Serving

Режим генерации контента с помощью ИИ для динамических веб-страниц

## Что такое Vibe-Serving?

Vibe-Serving - это уникальная функция PyServe, которая позволяет генерировать веб-страницы динамически с использованием языковых моделей ИИ. Вместо обслуживания статических файлов PyServe может генерировать контент на лету на основе промптов, которые вы настраиваете для различных маршрутов.

:::info Как это работает
1. Пользователь посещает URL (например, `/about`)
2. PyServe ищет настроенный промпт для этого маршрута
3. Промпт отправляется модели ИИ (OpenAI, Claude и т.д.)
4. ИИ генерирует полную HTML-страницу
5. Страница кэшируется и обслуживается пользователю
:::

## Конфигурация

Vibe-Serving настраивается через отдельный файл `vibeconfig.yaml`:

```yaml
routes:
  "/": "Сгенерируй красивую главную страницу для PyServe. Используй HTML и CSS."
  "/about": "Сгенерируй страницу 'О нас' для PyServe. Кратко опиши проект."
  "/contact": "Создай страницу контактов с формой обратной связи."

settings:
  cache_ttl: 3600              # Время кэширования в секундах
  model: "claude-3.5-sonnet"   # Модель ИИ для использования
  timeout: 3600                # Таймаут запроса в секундах
  api_url: "https://your.llm.provider/api/v1/completion"  # Пользовательская конечная точка API
  fallback_enabled: true       # Включить возврат к странице ошибки
```

### Переменные окружения

Вам нужно настроить переменные окружения для доступа к API ИИ. Создайте файл `.env`:

```bash
OPENAI_API_KEY=your_api_key_here
```

## Запуск Vibe-Serving

Чтобы включить режим Vibe-Serving, используйте флаг `--vibe-serving`:

```bash
python run.py --vibe-serving
```

Это запустит PyServe в специальном режиме, где он генерирует контент с помощью ИИ вместо обслуживания статических файлов.

:::warning Важно
Убедитесь, что вы настроили свои учетные данные API ИИ и имеете достаточную квоту API, поскольку каждая генерация страницы требует вызова API (если не кэширована).
:::

## Поддерживаемые модели ИИ

Vibe-Serving поддерживает различные модели ИИ через API, совместимые с OpenAI:

| Модель | Провайдер | Конфигурация |
|--------|-----------|--------------|
| `gpt-3.5-turbo` | OpenAI | API OpenAI по умолчанию |
| `gpt-4` | OpenAI | API OpenAI по умолчанию |
| `claude-3.5-sonnet` | Anthropic (через прокси) | Требуется пользовательский `api_url` |
| Локальные модели | Ollama и т.д. | Требуется пользовательский `api_url` |

:::info Общее представление про поддерживаемые модели
PyServe работает по факту с любыми OpenAI совместимыми API, можете использовать любые доступные вам модели через совместимое API.
:::

## Расширенная конфигурация

### Пользовательские конечные точки API

Для использования альтернативных провайдеров или локальных моделей:

```yaml
settings:
  api_url: "http://localhost:11434/v1"  # Ollama
  model: "llama2"
```

### Настройки для конкретных маршрутов

Вы можете настроить различные модели или настройки для конкретных маршрутов:

```yaml
routes:
  "/":
    prompt: "Создай современную целевую страницу для PyServe"
    model: "gpt-4"
    cache_ttl: 7200
  "/docs":
    prompt: "Сгенерируй исчерпывающую документацию"
    model: "claude-3.5-sonnet"
    cache_ttl: 3600
```

### Конфигурация кэширования

Управляйте тем, как кэшируется сгенерированный контент:

```yaml
settings:
  cache_ttl: 3600        # Время кэширования по умолчанию
  cache_enabled: true    # Включить/отключить кэширование
  cache_dir: "./cache"   # Директория кэша
```

## Разработка промптов

### Лучшие практики

1. **Будьте конкретными**: Включайте подробные инструкции о желаемом формате вывода
2. **Задавайте контекст**: Предоставляйте информацию о PyServe и его назначении
3. **Включайте стилизацию**: Указывайте требования CSS для согласованного дизайна
4. **Определяйте структуру**: Описывайте ожидаемую HTML-структуру

### Примеры промптов

**Целевая страница:**
```yaml
"/": |
  Создай современную, адаптивную целевую страницу для PyServe, HTTP-сервера Python.
  
  Требования:
  - Чистый, профессиональный дизайн
  - Включи секцию героя с логотипом PyServe
  - Особенности: Быстрый, Легкий, Простой в использовании
  - Кнопка призыва к действию, ссылающаяся на /docs
  - Используй современный CSS с flexbox/grid
  - Включи переключатель темной/светлой темы
  - Мобильно-адаптивный дизайн
```

**Страница документации:**
```yaml
"/docs": |
  Сгенерируй исчерпывающую страницу документации для PyServe.
  
  Включи:
  - Оглавление
  - Инструкции по установке
  - Примеры базового использования
  - Опции конфигурации
  - Примеры кода с подсветкой синтаксиса
  - Навигационные ссылки на другие разделы
```

## Обработка ошибок

### Резервные страницы

Настройте резервное поведение при сбое генерации ИИ:

```yaml
settings:
  fallback_enabled: true
  fallback_page: "./static/error.html"
  fallback_message: "Контент временно недоступен"
```

### Обработка таймаутов

Установите соответствующие таймауты для запросов ИИ:

```yaml
settings:
  timeout: 30          # Таймаут 30 секунд
  retry_attempts: 3    # Количество попыток повтора
  retry_delay: 5       # Задержка между повторами (секунды)
```

## Оптимизация производительности

### Стратегия кэширования

1. **Агрессивное кэширование**: Устанавливайте длительное время кэширования для стабильного контента
2. **Селективная регенерация**: Используйте более короткое время кэширования для динамического контента
3. **Ручная инвалидация кэша**: Очищайте кэш при необходимости

```bash
# Очистить весь кэш
python run.py --clear-cache

# Очистить кэш конкретного маршрута
python run.py --clear-cache /about
```

### Предварительная генерация

Генерируйте контент заранее для лучшей производительности:

```bash
# Предварительно сгенерировать все настроенные маршруты
python run.py --vibe-serving --pre-generate

# Предварительно сгенерировать конкретные маршруты
python run.py --vibe-serving --pre-generate /home /about
```

## Соображения безопасности

### Защита API-ключей

1. Никогда не коммитьте API-ключи в систему контроля версий
2. Используйте переменные окружения или безопасное управление ключами
3. Регулярно меняйте ключи
4. Мониторьте использование API на предмет необычной активности

### Фильтрация контента

Реализуйте фильтрацию контента для обеспечения соответствующего вывода:

```yaml
settings:
  content_filter: true
  blocked_keywords: ["неподходящее", "вредное"]
  max_content_length: 50000  # Максимальная длина сгенерированного контента
```

### Ограничение скорости

Защитите от злоупотреблений с помощью ограничения скорости:

```yaml
settings:
  rate_limit: 10          # Запросов в минуту на IP
  burst_limit: 5          # Допустимый всплеск
  cooldown_period: 300    # Период охлаждения в секундах
```

## Мониторинг и логирование

### Логирование запросов ИИ

Включите подробное логирование для запросов ИИ:

```yaml
logging:
  level: INFO
  ai_requests: true
  cache_hits: true
  generation_time: true
```

### Сбор метрик

Отслеживайте важные метрики:

- Успешность генерации
- Среднее время ответа
- Коэффициент попадания в кэш
- Стоимость API
- Удовлетворенность пользователей

## Устранение неполадок

### Частые проблемы

**API-ключ не работает:**
```bash
# Тестирование API-ключа
python run.py --test-api-key
```

**Таймаут генерации:**
```yaml
settings:
  timeout: 60  # Увеличить таймаут
```

**Проблемы с кэшем:**
```bash
# Очистить и пересобрать кэш
python run.py --clear-cache --pre-generate
```

**Модель недоступна:**
```yaml
settings:
  model: "gpt-3.5-turbo"  # Использовать альтернативную модель
```

## Лучшие практики

1. **Начинайте просто**: Начните с базовых промптов и постепенно добавляйте сложность
2. **Тщательно тестируйте**: Тестируйте все маршруты перед развертыванием
3. **Мониторьте расходы**: Отслеживайте использование и расходы API ИИ
4. **Кэшируйте стратегически**: Балансируйте свежесть с производительностью
5. **Имейте резервы**: Всегда предоставляйте резервный контент для сбоев
6. **Оптимизируйте промпты**: Уточняйте промпты на основе качества вывода
7. **Безопасность прежде всего**: Реализуйте правильные меры безопасности с самого начала

## Примеры интеграции

### Сайт электронной коммерции

```yaml
routes:
  "/": "Создай современную главную страницу интернет-магазина с витриной товаров"
  "/products": "Сгенерируй страницу списка товаров с опциями фильтрации"
  "/product/{id}": "Создай подробную страницу товара для товара {id}"
```

### Блог-платформа

```yaml
routes:
  "/": "Сгенерируй главную страницу блога с последними постами"
  "/post/{slug}": "Создай страницу поста блога для '{slug}'"
  "/category/{name}": "Сгенерируй страницу категории для '{name}'"
```

### Сайт-портфолио

```yaml
routes:
  "/": "Создай главную страницу личного портфолио"
  "/portfolio": "Сгенерируй страницу галереи портфолио"
  "/contact": "Создай профессиональную страницу контактов с формой"
```