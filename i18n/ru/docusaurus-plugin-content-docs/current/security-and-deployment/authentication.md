---
sidebar_position: 1
---

# Аутентификация

Узнайте, как защитить ваши маршруты с помощью базовой HTTP-аутентификации в PyServe

## Обзор базовой аутентификации

PyServe поддерживает базовую HTTP-аутентификацию для защиты определенных маршрутов в вашем приложении. Эта функция позволяет ограничить доступ к определенным путям, требуя от пользователей предоставления действительных учетных данных перед доступом к контенту.

> **Примечание:** Базовая аутентификация отправляет учетные данные в закодированном (не зашифрованном) виде. Для использования в производстве всегда включайте SSL/TLS для защиты процесса аутентификации.

## Конфигурация

Аутентификация настраивается в разделе `locations` файла `config.yaml`. Вы можете защитить несколько маршрутов с разными учетными данными.

```yaml
server:
  locations:
    /admin:  # Маршрут для защиты
      auth:
        type: basic
        username: admin
        password: secretpass
    /api:    # Еще один защищенный маршрут
      auth:
        type: basic
        username: apiuser
        password: apipass
```

### Опции конфигурации

| Опция | Описание | Обязательно |
|-------|----------|-------------|
| `type` | Тип аутентификации (в настоящее время поддерживается только 'basic') | Да |
| `username` | Имя пользователя для аутентификации | Да |
| `password` | Пароль для аутентификации | Да |

## Как это работает

Когда клиент пытается получить доступ к защищенному маршруту:

1. Если учетные данные не предоставлены, сервер отвечает кодом статуса 401 и заголовком `WWW-Authenticate`
2. Браузер показывает диалог входа пользователю
3. Пользователь вводит учетные данные, которые кодируются в base64 и отправляются в заголовке `Authorization`
4. Сервер проверяет учетные данные и либо:
   - Предоставляет доступ, если учетные данные действительны
   - Возвращает 401, если учетные данные недействительны

```http
# Пример HTTP-обмена:

-> Запрос клиента без учетных данных:
GET /admin HTTP/1.1
Host: example.com

<- Ответ сервера:
HTTP/1.1 401 Unauthorized
WWW-Authenticate: Basic realm="Restricted Area"

-> Запрос клиента с учетными данными:
GET /admin HTTP/1.1
Host: example.com
Authorization: Basic YWRtaW46cGFzc3dvcmQ=

<- Ответ сервера при действительных учетных данных:
HTTP/1.1 200 OK
...
```

## Лучшие практики безопасности

- Всегда используйте HTTPS (SSL/TLS) при использовании базовой аутентификации
- Используйте надежные пароли
- Рассмотрите реализацию ограничения скорости для неудачных попыток аутентификации
- Используйте переменные окружения для конфиденциальных учетных данных вместо их жесткого кодирования в файлах конфигурации
- Регулярно меняйте учетные данные
- Рассмотрите использование более безопасных методов аутентификации для конфиденциальных данных

> **Предупреждение:** Базовая аутентификация не должна использоваться как единственная мера безопасности для высокочувствительных данных. Рассмотрите реализацию дополнительных мер безопасности, таких как управление сессиями или аутентификация на основе токенов для таких случаев.

## Логирование

Попытки аутентификации логируются для мониторинга безопасности. Неудачные попытки аутентификации логируются на уровне WARNING, а успешные - на уровне DEBUG.

```
[2024-03-21 14:30:45] [WARNING] Недействительные учетные данные для пользователя: admin
[2024-03-21 14:30:52] [DEBUG] Базовая аутентификация успешна для пользователя: admin
```

Включите логирование уровня DEBUG, чтобы видеть подробную информацию об аутентификации:

```yaml
logging:
  level: DEBUG
```

## Примеры

### Защита нескольких маршрутов

```yaml
server:
  locations:
    /admin:
      auth:
        type: basic
        username: admin
        password: adminpass
    /api:
      auth:
        type: basic
        username: apiuser
        password: apipass
    /docs:
      auth:
        type: basic
        username: docs
        password: docspass
```

### Использование переменных окружения

```bash
# Установить переменные окружения
export ADMIN_USER=admin
export ADMIN_PASS=secretpass
```

```yaml
# В config.yaml
server:
  locations:
    /admin:
      auth:
        type: basic
        username: ${ADMIN_USER}
        password: ${ADMIN_PASS}
```

## Устранение неполадок

### Частые проблемы

| Проблема | Возможное решение |
|----------|------------------|
| Диалог аутентификации появляется повторно | Проверьте, правильны ли учетные данные и правильно ли они настроены в config.yaml |
| Нет запроса аутентификации | Убедитесь, что маршрут правильно настроен в разделе locations |
| Учетные данные не работают | Проверьте файлы логов на предмет подробных сообщений об ошибках и убедитесь в правильности учетных данных в конфигурации |