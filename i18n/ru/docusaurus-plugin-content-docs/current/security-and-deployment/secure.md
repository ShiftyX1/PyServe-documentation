---
sidebar_position: 2
---

# Безопасные соединения

Узнайте, как использовать PyServe с SSL/TLS для HTTPS

## Обзор безопасных соединений

PyServe теперь поддерживает SSL/TLS для безопасных HTTPS-соединений. Это позволяет шифровать весь трафик между клиентом и сервером. Настоятельно рекомендуется использовать SSL при открытии PyServe в общедоступном интернете.

:::info
**Распространенные случаи использования:** SSL обычно используется для защиты конфиденциальных данных, обеспечения целостности данных, проверки подлинности сервера и соблюдения требований безопасности. Реализация HTTPS является требованием для современных веб-приложений.
:::

## Настройка SSL

Существует два способа настройки SSL в PyServe:

### 1. Использование файла конфигурации

Добавьте раздел `ssl` в файл `config.yaml`:

```yaml
ssl:
  enabled: true
  cert_file: ./ssl/cert.pem
  key_file: ./ssl/key.pem
```

### 2. Использование аргументов командной строки

Используйте опцию `--ssl` вместе с путями к сертификату и ключу при запуске PyServe:

```bash
python run.py --ssl --cert ./ssl/cert.pem --key ./ssl/key.pem
```

Или сохраните эти настройки в файл конфигурации, используя:

```bash
python run.py --ssl-config --ssl --cert ./ssl/cert.pem --key ./ssl/key.pem
```

### Параметры конфигурации

- `enabled`: Включен ли SSL (true/false)
- `cert_file`: Путь к файлу SSL-сертификата (формат .pem)
- `key_file`: Путь к файлу приватного ключа SSL (формат .pem)

## Создание SSL-сертификатов

### Самоподписанные сертификаты (разработка)

Для целей разработки и тестирования вы можете создать самоподписанные сертификаты с помощью OpenSSL:

```bash
# Создать директорию для сертификатов
mkdir -p ./ssl

# Сгенерировать приватный ключ и самоподписанный сертификат
openssl req -x509 -newkey rsa:4096 -keyout ./ssl/key.pem -out ./ssl/cert.pem -days 365 -nodes
```

:::warning
**Примечание:** Самоподписанные сертификаты заставят браузеры показывать предупреждения безопасности. Они подходят для разработки, но не для использования в производстве.
:::

### Производственные сертификаты

Для производственных сред получите сертификаты от доверенного центра сертификации, такого как Let's Encrypt:

```bash
# Использование certbot (Let's Encrypt)
sudo certbot certonly --standalone --preferred-challenges http -d yourdomain.com
```

Затем настройте PyServe для использования сгенерированных сертификатов:

```bash
python run.py --ssl --cert /etc/letsencrypt/live/yourdomain.com/fullchain.pem --key /etc/letsencrypt/live/yourdomain.com/privkey.pem
```

## SSL с обратным прокси

PyServe может использовать SSL и обратный прокси одновременно, создавая безопасный шлюз к вашим бэкенд-сервисам. Это особенно полезно для защиты внутренних сервисов, которые не реализуют собственный SSL.

### Пример конфигурации

```yaml
ssl:
  enabled: true
  cert_file: ./ssl/cert.pem
  key_file: ./ssl/key.pem

server:
  reverse_proxy:
    - path: /api
      host: localhost
      port: 3000
```

В этой настройке:
1. Клиенты подключаются к PyServe, используя HTTPS (безопасное соединение)
2. PyServe проксирует запросы к бэкенд-сервису по HTTP (внутренняя сеть)
3. Связь между клиентом и интернетом надежно зашифрована

:::info
**Лучшая практика:** Для производственных сред рассмотрите также защиту соединения с бэкенд-серверами, особенно если они находятся на разных машинах.
:::

## Как работают безопасные соединения

Когда SSL включен в PyServe:

1. PyServe загружает сертификат и приватный ключ при запуске
2. Сервер настроен на прослушивание HTTPS-соединений вместо HTTP
3. Когда клиент подключается, SSL-рукопожатие устанавливает безопасное соединение
4. Все последующие данные, передаваемые между клиентом и сервером, шифруются

### Проверка сертификата

Когда клиент подключается к экземпляру PyServe с включенным SSL, их браузер проверит сертификат сервера:

- Для сертификатов от доверенных ЦС: Соединение устанавливается с иконкой замка
- Для самоподписанных сертификатов: Браузер покажет предупреждение, которое нужно обойти

:::info
**Техническая заметка:** PyServe использует встроенный SSL-модуль Python и поддержку SSL в asyncio для реализации безопасных соединений, обеспечивая стандартное TLS-шифрование.
:::

## Лучшие практики безопасности

### Безопасность сертификатов

- Держите ваш приватный ключ в безопасности и ограничьте права доступа (`chmod 400 ./ssl/key.pem`)
- Регулярно обновляйте сертификаты до их истечения (сертификаты Let's Encrypt истекают через 90 дней)
- Используйте длинные ключи (рекомендуется 4096 бит для RSA-ключей)

### Конфигурация SSL

- Используйте TLS 1.2 или выше (PyServe использует стандартный SSL-контекст Python, который приоритизирует безопасные протоколы)
- Рассмотрите реализацию HTTP Strict Transport Security (HSTS), если ваш сайт должен всегда использовать HTTPS
- Перенаправляйте HTTP-трафик на HTTPS при работе в производстве

### Безопасность сервера

- Поддерживайте вашу установку PyServe и ее зависимости в актуальном состоянии
- Используйте брандмауэр для ограничения доступа к вашему серверу
- Рассмотрите использование обратного прокси, такого как Nginx, для производственных сред с высоким трафиком

## Устранение неполадок

### Частые проблемы

#### Проблемы с SSL-сертификатом

Если вы видите ошибку типа `Ошибка загрузки SSL-сертификатов`, проверьте, что:
- Файлы сертификата и ключа существуют по указанным путям
- Файлы имеют правильный формат PEM
- PyServe имеет разрешения на чтение этих файлов

#### Предупреждения безопасности браузера

Если браузеры показывают предупреждения безопасности при подключении к вашему серверу:
- Для разработки: Это нормально для самоподписанных сертификатов
- Для производства: Убедитесь, что используете сертификат от доверенного ЦС
- Проверьте, что ваш сертификат не истек
- Убедитесь, что домен сертификата соответствует домену вашего сервера

#### Отладочное логирование

Включите режим отладки, чтобы видеть подробные логи SSL-соединений:

```bash
python run.py -d --ssl --cert ./ssl/cert.pem --key ./ssl/key.pem
```

## Соображения производительности

Включение SSL добавляет некоторые накладные расходы на операции сервера из-за процессов шифрования/дешифрования:

- Установление первоначального соединения занимает больше времени из-за SSL-рукопожатия
- Использование CPU будет несколько выше из-за операций шифрования/дешифрования
- Использование памяти увеличивается для поддержания SSL-контекстов

Однако с современным оборудованием эти накладные расходы обычно минимальны, и преимущества безопасности намного перевешивают затраты на производительность.

:::info
**Примечание:** Асинхронная архитектура PyServe помогает снизить накладные расходы SSL, эффективно обрабатывая множественные соединения.
:::